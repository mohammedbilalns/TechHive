<%- include('../partials/adminheader') %>

<div class="flex flex-col md:flex-row">
  <!-- Sidebar -->
  <aside id="sidebar" class="bg-gray-100 w-full md:w-64 min-h-screen hidden md:block transform transition-transform duration-300 ease-in-out">
    <nav class="py-4">
      <div class="px-4 md:px-6">
        <h2 class="text-sm font-semibold text-gray-600 uppercase">Menu</h2>
        <ul class="mt-4 space-y-2">
          <li>
            <a href="/admin/dashboard" onclick="return false" class="flex items-center px-4 py-2 text-gray-800 hover:bg-gray-200 rounded-lg">
              <i class="fas fa-th-large mr-3"></i>
              <span>Dashboard</span>
            </a>
          </li>
          <li>
            <a href="/admin/products" class="flex items-center px-4 py-2 bg-primary-accent text-gray-200 hover:bg-primary-hover rounded-lg">
              <i class="fas fa-box mr-3"></i>
              <span>Products</span>
            </a>
          </li>
          <li>
            <a href="/admin/categories" class="flex items-center px-4 py-2 text-gray-800 hover:bg-gray-200 rounded-lg">
              <i class="fas fa-layer-group mr-3"></i>
              <span>Category</span>
            </a>
          </li>
          <li>
            <a href="/admin/orders" onclick="return false" class="flex items-center px-4 py-2 text-gray-800 hover:bg-gray-200 rounded-lg">
              <i class="fas fa-shopping-cart mr-3"></i>
              <span>Orders</span>
            </a>
          </li>
          <li>
            <a href="/admin/coupons" onclick="return false" class="flex items-center px-4 py-2 text-gray-800 hover:bg-gray-200 rounded-lg">
              <i class="fas fa-ticket-alt mr-3"></i>
              <span>Coupon</span>
            </a>
          </li>
          <li>
            <a href="/admin/banners" onclick="return false" class="flex items-center px-4 py-2 text-gray-800 hover:bg-gray-200 rounded-lg">
              <i class="fas fa-images mr-3"></i>
              <span>Banner</span>
            </a>
          </li>
          <li>
            <a href="/admin/transactions" onclick="return false" class="flex items-center px-4 py-2 text-gray-800 hover:bg-gray-200 rounded-lg">
              <i class="fas fa-receipt mr-3"></i>
              <span>Transaction</span>
            </a>
          </li>
        </ul>
      </div>
      <div class="px-4 md:px-6 mt-8">
        <h2 class="text-sm font-semibold text-gray-600 uppercase">User Management</h2>
        <ul class="mt-4 space-y-2">
          <li>
            <a href="/admin/admins" onclick="return false" class="flex items-center px-4 py-2 text-gray-800 hover:bg-gray-200 rounded-lg">
              <i class="fas fa-user-shield mr-3"></i>
              <span>Manage Admins</span>
            </a>
          </li>
          <li>
            <a href="/admin/customers"  class="flex items-center px-4 py-2 text-gray-800 hover:bg-gray-200 rounded-lg">
              <i class="fas fa-users mr-3"></i>
              <span>Customers</span>
            </a>
          </li>
        </ul>
      </div>
      <div class="px-4 md:px-6 mt-8">
        <h2 class="text-sm font-semibold text-gray-600 uppercase">Others</h2>
        <ul class="mt-4 space-y-2">
          <li>
            <a href="/admin/settings" onclick="return false" class="flex items-center px-4 py-2 text-gray-800 hover:bg-gray-200 rounded-lg">
              <i class="fas fa-cogs mr-3"></i>
              <span>Settings</span>
            </a>
          </li>
          <li>
            <a href="/admin/help" onclick="return false" class="flex items-center px-4 py-2 text-gray-800 hover:bg-gray-200 rounded-lg">
              <i class="fas fa-question-circle mr-3"></i>
              <span>Help</span>
            </a>
          </li>
          <li>
            <a href="/admin/logout" onclick="return false" class="flex items-center px-4 py-2 text-gray-800 hover:bg-gray-200 rounded-lg">
              <i class="fas fa-sign-out-alt mr-3"></i>
              <span>Logout</span>
            </a>
          </li>
        </ul>
      </div>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="flex-grow p-4 md:py-12">
    <% if (locals.message && locals.alertType) { %>
      <div id="alertMessage" class="mb-4 p-3 rounded-md 
           <%= alertType === 'error' ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700' %>">
        <%= message %>
      </div>
    <% } %>

    <div class="bg-primary-white rounded-lg shadow-lg w-full overflow-hidden">
      <!-- Page Header -->
      <div class="flex flex-col md:flex-row justify-between items-center bg-gray-50 px-4 md:px-6 py-4 border-b space-y-4 md:space-y-0">
        <h1 class="text-xl md:text-2xl font-semibold text-gray-800">Products Dashboard</h1>
        <div class="flex gap-4">
          <div class="relative">
            <input type="text" id="searchBox" placeholder="Search..."
              class="w-full md:w-64 border border-gray-300 rounded-md px-4 py-2 text-sm focus:ring-blue-500 focus:border-blue-500"
              oninput="filterProducts()" />
            <i class="fas fa-search absolute top-3 right-4 text-gray-400"></i>
          </div>
          <form action="/admin/products/add" >
          <button type="submit" class="flex items-center bg-blue-500 text-white px-4 py-2 rounded-md shadow w-full md:w-auto justify-center"
            >
            <i class="fas fa-plus mr-2"></i> Add Product
          </button>
          </form>
          <button class="flex items-center bg-primary-accent text-white px-4 py-2 rounded-md shadow w-full md:w-auto justify-center"
            onclick="exportCategories()">
            <i class="fas fa-download mr-2"></i> Export
          </button>
        </div>
      </div>

      <!-- Products Table -->
      <div class="overflow-x-auto mt-6">
        <table class="min-w-full bg-gray-50 text-sm">
          <thead>
            <tr class="text-left text-gray-600">
              <th class="px-6 py-3">#</th>
              <th class="px-6 py-3">Image</th>
              <th class="px-6 py-3">Name</th>
              <th class="px-6 py-3">Category</th>
              <th class="px-6 py-3">Price</th>
              <th class="px-6 py-3">Discount (%)</th>
              <th class="px-6 py-3">Stock</th>
              <th class="px-6 py-3">Status</th>
              <th class="px-6 py-3">Variant</th>
              <th class="px-6 py-3 text-center">Actions</th>
            </tr>
          </thead>
          <tbody id="productsTable" class="text-gray-700">
            <% products.forEach((product, index) => { %>
              <tr class="border-b hover:bg-gray-100">
                <td class="px-6 py-3 font-medium"><%= index + 1 %></td>
                <td class="px-6 py-3"><img src="<%= product.images[0] %>" alt="Product" class="w-12 h-12 rounded-md"></td>
                <td class="px-6 py-3"><%= product.name %></td>
                <td class="px-6 py-3"><%= product.category.name %></td>
                <td class="px-6 py-3">â‚¹<%= product.price %></td>
                <td class="px-6 py-3"><%= product.discount %></td>
                <td class="px-6 py-3"><%= product.stock %></td>
                <td class="px-6 py-3">
                  <span class="px-3 py-1 rounded-full text-sm font-medium
                    <%= product.status === 'Active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800' %>">
                    <%= product.status %>
                  </span>
                </td>
                <td class="px-6 py-3"><%= product.variant %></td>
                <td class="px-6 py-3 text-center">
                  <div class="flex justify-center gap-2">
                    <% if (product.status === 'Active') { %>
                      <form action="/admin/products/deactivate/<%= product._id %>" method="POST" 
                        onsubmit="return confirm('Are you sure you want to deactivate the product?')">
                        <button type="submit" class="bg-primary-accent text-white px-4 py-2 rounded-md hover:bg-red-600">
                          Deactivate
                        </button>
                      </form>
                    <% } else { %>
                      <form action="/admin/products/activate/<%= product._id %>" method="POST" 
                        onsubmit="return confirm('Are you sure you want to activate the product?')">
                        <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600">
                          Activate
                        </button>
                      </form>
                    <% } %>
                    <button class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600"
                      onclick="editProduct('<%= product._id %>')">Edit</button>
                    <form action="/admin/products/delete/<%= product._id %>" 
                      onsubmit="return confirm('Are you sure you want delete the product?')">
                      <button type="submit"
                        class="bg-primary-accent text-white px-4 py-2 rounded-md hover:bg-red-600">Delete</button>
                    </form>
                  </div>
                </td>
              </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
    </div>
  </main>
</div>



<%- include('../partials/adminfooter') %>